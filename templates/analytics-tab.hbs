{{!-- Narrator Master - Analytics Tab Template --}}
{{!-- Session analytics and player engagement metrics --}}

<div class="analytics-tab-container">
    {{!-- Current Session Section --}}
    <section class="analytics-section current-session">
        <div class="section-header">
            <h3>
                <i class="fas fa-chart-line"></i>
                {{i18n.currentSession}}
            </h3>
            {{#if hasCurrentSession}}
            <div class="session-actions">
                <button type="button" class="end-session" title="{{i18n.endSession}}">
                    <i class="fas fa-stop-circle"></i>
                    {{i18n.endSession}}
                </button>
            </div>
            {{/if}}
        </div>

        {{#if hasCurrentSession}}
        <div class="session-summary">
            <div class="summary-stats">
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <span class="stat-label">{{i18n.totalDuration}}</span>
                    <span class="stat-value">{{currentSession.duration}}</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-users"></i>
                    <span class="stat-label">{{i18n.speakerCount}}</span>
                    <span class="stat-value">{{currentSession.speakerCount}}</span>
                </div>
            </div>
        </div>

        {{!-- Speaker Statistics --}}
        <div class="speaker-stats">
            <h4>{{i18n.speakingTime}}</h4>
            {{#if hasSpeakers}}
            <ul class="speaker-list">
                {{#each currentSession.speakers}}
                <li class="speaker-item">
                    <div class="speaker-info">
                        <span class="speaker-name">{{this.name}}</span>
                        <span class="speaker-time">{{this.formattedTime}}</span>
                    </div>
                    <div class="speaking-time-bar-container">
                        <div class="speaking-time-bar"
                             style="width: {{this.percentage}}%"
                             title="{{this.percentage}}%">
                        </div>
                    </div>
                    <div class="speaker-metrics">
                        <span class="metric">{{this.percentage}}%</span>
                        <span class="segment-count">{{this.segmentCount}} {{i18n.segments}}</span>
                    </div>
                </li>
                {{/each}}
            </ul>
            {{else}}
            <div class="empty-state">
                <i class="fas fa-microphone-slash"></i>
                <p>{{i18n.noSpeakersYet}}</p>
            </div>
            {{/if}}
        </div>
        {{else}}
        <div class="empty-state">
            <i class="fas fa-play-circle"></i>
            <p>{{i18n.noActiveSession}}</p>
            <button type="button" class="start-session {{#unless apiKeyConfigured}}disabled{{/unless}}"
                    {{#unless apiKeyConfigured}}disabled{{/unless}}>
                <i class="fas fa-microphone"></i>
                {{i18n.startRecording}}
            </button>
        </div>
        {{/if}}
    </section>

    {{!-- Session Timeline Section --}}
    {{#if hasCurrentSession}}
    <section class="analytics-section session-timeline">
        <div class="section-header">
            <h3>
                <i class="fas fa-chart-bar"></i>
                {{i18n.timeline}}
            </h3>
        </div>

        {{#if hasTimelineData}}
        <div class="timeline-visualization">
            <div class="timeline-bars">
                {{#each timeline}}
                <div class="timeline-bucket" data-timestamp="{{this.timestamp}}">
                    <div class="bucket-bar"
                         style="height: {{this.heightPercent}}%"
                         title="{{this.label}}">
                        {{#each this.speakerBars}}
                        <div class="speaker-segment"
                             style="height: {{this.heightPercent}}%; background-color: {{this.color}}"
                             title="{{this.speakerName}}: {{this.duration}}s">
                        </div>
                        {{/each}}
                    </div>
                    <span class="bucket-time">{{this.timeLabel}}</span>
                </div>
                {{/each}}
            </div>
            <div class="timeline-legend">
                {{#each speakers}}
                <div class="legend-item">
                    <span class="legend-color" style="background-color: {{this.color}}"></span>
                    <span class="legend-label">{{this.name}}</span>
                </div>
                {{/each}}
            </div>
        </div>
        {{else}}
        <div class="empty-state">
            <i class="fas fa-chart-area"></i>
            <p>{{i18n.noTimelineData}}</p>
        </div>
        {{/if}}
    </section>
    {{/if}}

    {{!-- Session History Section --}}
    <section class="analytics-section session-history">
        <div class="section-header">
            <h3>
                <i class="fas fa-history"></i>
                {{i18n.sessionHistory}}
            </h3>
            {{#if hasHistory}}
            <div class="history-actions">
                <button type="button" class="clear-history" title="{{i18n.clearHistory}}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            {{/if}}
        </div>

        {{#if hasHistory}}
        <ul class="session-history-list">
            {{#each sessionHistory}}
            <li class="history-item" data-session-id="{{this.sessionId}}">
                <div class="history-header">
                    <span class="history-date">
                        <i class="fas fa-calendar-alt"></i>
                        {{this.formattedDate}}
                    </span>
                    <span class="history-duration">
                        <i class="fas fa-clock"></i>
                        {{this.duration}}
                    </span>
                </div>
                <div class="history-stats">
                    <span class="history-stat">
                        <i class="fas fa-users"></i>
                        {{this.speakerCount}} {{i18n.speakers}}
                    </span>
                    {{#if this.dominantSpeaker}}
                    <span class="history-stat">
                        <i class="fas fa-crown"></i>
                        {{this.dominantSpeaker}}
                    </span>
                    {{/if}}
                </div>
                <div class="history-actions">
                    <button type="button" class="view-session" data-session-id="{{this.sessionId}}" title="{{i18n.viewDetails}}">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="export-session" data-session-id="{{this.sessionId}}" title="{{i18n.exportSession}}">
                        <i class="fas fa-download"></i>
                    </button>
                    <button type="button" class="delete-session" data-session-id="{{this.sessionId}}" title="{{i18n.deleteSession}}">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </li>
            {{/each}}
        </ul>
        {{else}}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>{{i18n.noSessionHistory}}</p>
        </div>
        {{/if}}
    </section>
</div>
